<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Cozy Dashboard</title>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #f0e8de;
            color: #5c5042;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            min-height: 100vh;
        }

        .grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            max-width: 720px;
            padding-top: 40px;
        }

        /* Card styling */
        .card {
            background: linear-gradient(145deg, #fffcf9, #f7f0e9);
            border-radius: 20px;
            padding: 16px;
            box-shadow: 0 8px 20px rgba(107, 92, 74, 0.05);
            border: 1px solid #efe6dc;
            text-align: center;
            position: relative;
            transition: transform 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        /* Gear icon */
        .gear {
            position: absolute;
            top: 10px;
            right: 12px;
            cursor: pointer;
            font-size: 16px;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        
        .gear:hover {
            opacity: 1;
        }

        /* Titles */
        .title {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #9c8c74;
        }

        /* Clock */
        #clock {
            font-size: 32px;
            font-weight: 700;
            color: #558b76;
            letter-spacing: -1px;
        }
        #date {
            font-size: 18px;
            color: #8c7b66;
            margin-bottom: 4px;
        }

        /* Weather */
        .weather-row {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 10px 0;
        }
        .large-temp {
            font-size: 48px;
            font-weight: 600;
            color: #333;
        }
        .condition-icon {
            font-size: 42px;
        }
        #weatherInfo {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }

        /* Precipitation Graph */
        .precip-grid {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 50px;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #e0d0c0;
        }
        .precip-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .precip-bar {
            width: 6px;
            border-radius: 4px;
            background: #a4c5e0;
            min-height: 2px;
        }
        .precip-hour {
            font-size: 9px;
            color: #a09080;
            margin-top: 4px;
        }

        /* Content Text */
        .content-text {
            font-size: 15px;
            line-height: 1.5;
            color: #4a4036;
        }
        .sub-text {
            font-size: 13px;
            color: #887868;
            font-style: italic;
            margin-top: 5px;
        }

        /* Headlines */
        #newsCard ul {
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: left;
        }
        #newsCard li {
            padding: 6px 0;
            border-bottom: 1px solid #f0e6dc;
        }
        #newsCard li:last-child { border-bottom: none; }
        #newsCard a {
            text-decoration: none;
            color: #5c5042;
            font-size: 13px;
            font-weight: 500;
            display: block;
        }
        #newsCard a:hover { color: #558b76; }

        /* Image */
        #imageCard { padding: 0; overflow: hidden; }
        #imageCard img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        #imageCard .title-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.85);
            padding: 8px;
            font-size: 12px;
            font-weight: bold;
            color: #6b5c4a;
        }

        /* Grid System */
        .half-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        .half-grid .card {
            flex: 1 1 calc(30% - 12px);
            min-width: 250px;
        }
    </style>
</head>

<body>
    <div class="grid">
        <div class="card" id="weatherCard">
            <span class="gear" onclick="showLocationPrompt()" title="Set Location">‚öôÔ∏è</span>
            
            <div id="date">Loading...</div>
            <div id="clock">--:--</div>
            
            <div class="weather-row">
                <div class="condition-icon" id="weatherIcon">üå§Ô∏è</div>
                <div class="large-temp" id="currentTemp">--¬∞</div>
                <div style="text-align: left;">
                    <div id="minMaxTemp" style="font-weight: bold;">L:--¬∞ H:--¬∞</div>
                    <div id="sunData" style="font-size: 12px;">‚òÄÔ∏è --:-- üåô --:--</div>
                </div>
            </div>
            <div id="weatherInfo">Location: Unknown</div>
            
            <div class="precip-grid" id="precipContainer">
                </div>
        </div>

        <div class="card" id="newsCard">
            <div class="title">New York Times Top Stories</div>
            <ul id="headlines"><li>Loading headlines...</li></ul>
        </div>

        <div class="half-grid">
            <div class="card">
                <div class="title">Current ISS Location</div>
                <div class="content-text" id="issLocation">Tracking...</div>
                <div class="sub-text" style="font-size: 11px;">(Live Coordinates)</div>
            </div>

            <div class="card">
                <div class="title">Suggested Activity</div>
                <div class="content-text" id="activity">Loading...</div>
            </div>

            <div class="card">
                <div class="title">Did You Know?</div>
                <div class="content-text" id="fact">Loading...</div>
            </div>

            <div class="card">
                <div class="title">Daily Vibe</div>
                <div class="content-text" id="horoscope">Loading...</div>
            </div>

            <div class="card">
                <div class="title">Quote of the Day</div>
                <div class="content-text" id="quote">"..."</div>
                <div class="sub-text" id="quoteAuthor"></div>
            </div>

            <div class="card" id="imageCard">
                <img id="dailyImage" src="" alt="Nature Image" />
                <div class="title-overlay">Daily View</div>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration & Local Data Fallbacks ---
        
        // Local Activities (BoredAPI replacement - reliable & offline friendly)
        const ACTIVITIES = [
            "Read a chapter of a book", "Water your plants", "Take a 15-minute walk", 
            "Listen to a new album", "Stretch for 10 minutes", "Write in a journal", 
            "Organize your desk", "Cook a new recipe", "Call a friend", "Meditate for 5 minutes",
            "Draw a doodle", "Watch a documentary", "Clean out your email inbox", "Make a cup of herbal tea",
            "Learn 5 words in a new language", "Do a crossword puzzle", "Update your resume", "Back up your photos"
        ];

        // Local Horoscopes/Vibes (API replacement)
        const VIBES = [
            "Today is a good day to focus on yourself.", "Creativity flows through you today.", 
            "Patience is your superpower right now.", "A pleasant surprise is around the corner.",
            "Take it slow; there is no rush.", "Your energy is contagious today.",
            "Focus on the solution, not the problem.", "Rest is productive too.",
            "Trust your intuition.", "Be kind to yourself today."
        ];

        // --- Location Logic ---
        let LAT = localStorage.getItem('LAT') ? Number(localStorage.getItem('LAT')) : 40.71; // Default NY
        let LON = localStorage.getItem('LON') ? Number(localStorage.getItem('LON')) : -74.00;

        function showLocationPrompt() {
            const lat = prompt("Enter Latitude (e.g., 51.50):", LAT);
            const lon = prompt("Enter Longitude (e.g., -0.12):", LON);
            if (lat && lon) {
                LAT = parseFloat(lat);
                LON = parseFloat(lon);
                localStorage.setItem('LAT', LAT);
                localStorage.setItem('LON', LON);
                updateAll();
            }
        }

        // --- Clock ---
        function updateClock() {
            const now = new Date();
            const dateStr = now.toLocaleDateString("en-US", { weekday: "long", month: "long", day: "numeric" });
            const timeStr = now.toLocaleTimeString("en-US", { hour: "2-digit", minute: "2-digit" });
            document.getElementById("date").textContent = dateStr;
            document.getElementById("clock").textContent = timeStr;
        }

        // --- Weather (Open-Meteo: Free, No Key, CORS Friendly) ---
        const ICONS = { 0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 48: "üå´Ô∏è", 51: "üåßÔ∏è", 53: "üåßÔ∏è", 55: "üåßÔ∏è", 61: "üåßÔ∏è", 63: "üåßÔ∏è", 65: "üåßÔ∏è", 71: "‚ùÑÔ∏è", 73: "‚ùÑÔ∏è", 75: "‚ùÑÔ∏è", 80: "üå¶Ô∏è", 81: "üå¶Ô∏è", 82: "üåßÔ∏è", 95: "‚õàÔ∏è", 96: "‚õàÔ∏è", 99: "‚õàÔ∏è" };
        
        async function getWeather() {
            try {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&hourly=precipitation_probability,precipitation&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset&temperature_unit=fahrenheit&timezone=auto`;
                const res = await fetch(url);
                const data = await res.json();
                
                // Current
                const w = data.current_weather;
                document.getElementById("currentTemp").textContent = `${Math.round(w.temperature)}¬∞`;
                document.getElementById("weatherIcon").textContent = ICONS[w.weathercode] || "üåà";
                
                // Daily
                const max = Math.round(data.daily.temperature_2m_max[0]);
                const min = Math.round(data.daily.temperature_2m_min[0]);
                const sunrise = data.daily.sunrise[0].split('T')[1];
                const sunset = data.daily.sunset[0].split('T')[1];
                document.getElementById("minMaxTemp").textContent = `L: ${min}¬∞  H: ${max}¬∞`;
                document.getElementById("sunData").textContent = `‚òÄÔ∏è ${sunrise}  üåô ${sunset}`;
                document.getElementById("weatherInfo").textContent = `Lat: ${LAT.toFixed(2)}, Lon: ${LON.toFixed(2)}`;

                // Precip Graph (Next 12 hours)
                const currentHour = new Date().getHours();
                const precipData = data.hourly.precipitation.slice(currentHour, currentHour + 10);
                let precipHTML = '';
                
                precipData.forEach((p, i) => {
                    // Visual scaling: 0-2mm is the common range
                    let height = Math.min(p * 10, 40); 
                    // Add a tiny base height so 0 isn't invisible
                    height = height < 2 ? 2 : height;
                    const color = p > 0 ? '#5dade2' : '#e0e0e0';
                    const timeLabel = (currentHour + i) % 24;
                    
                    precipHTML += `
                        <div class='precip-item'>
                            <div class='precip-bar' style='height:${height}px; background:${color};' title='${p}mm'></div>
                            <div class='precip-hour'>${timeLabel}:00</div>
                        </div>
                    `;
                });
                document.getElementById("precipContainer").innerHTML = precipHTML;

            } catch (e) {
                console.error("Weather error", e);
                document.getElementById("weatherInfo").textContent = "Weather unavailable";
            }
        }

        // --- ISS Location (WhereTheISS - HTTPS/CORS Friendly) ---
        async function getISS() {
            try {
                const res = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
                const data = await res.json();
                document.getElementById("issLocation").textContent = 
                    `Lat: ${data.latitude.toFixed(2)} \n Lon: ${data.longitude.toFixed(2)}`;
            } catch {
                document.getElementById("issLocation").textContent = "Signal Lost...";
            }
        }

        // --- Fact (UselessFacts - HTTPS/CORS Friendly) ---
        async function getFact() {
            try {
                const res = await fetch('https://uselessfacts.jsph.pl/api/v2/facts/random?language=en');
                const data = await res.json();
                document.getElementById("fact").textContent = data.text;
            } catch {
                document.getElementById("fact").textContent = "Did you know? Facts are currently unavailable.";
            }
        }

        // --- Quote (DummyJSON - HTTPS/CORS Friendly) ---
        async function getQuote() {
            try {
                const res = await fetch('https://dummyjson.com/quotes/random');
                const data = await res.json();
                document.getElementById("quote").textContent = `"${data.quote}"`;
                document.getElementById("quoteAuthor").textContent = `‚Äî ${data.author}`;
            } catch {
                document.getElementById("quote").textContent = "Stay cozy.";
            }
        }

        // --- News (RSS2JSON - Limited but works) ---
        async function getNews() {
            try {
                const res = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Frss.nytimes.com%2Fservices%2Fxml%2Frss%2Fnyt%2FHomePage.xml');
                const data = await res.json();
                const list = document.getElementById("headlines");
                list.innerHTML = "";
                data.items.slice(0, 4).forEach(item => {
                    const li = document.createElement("li");
                    const a = document.createElement("a");
                    a.href = item.link;
                    a.textContent = item.title;
                    a.target = "_blank";
                    li.appendChild(a);
                    list.appendChild(li);
                });
            } catch {
                document.getElementById("headlines").innerHTML = "<li>News feed unavailable</li>";
            }
        }

        // --- Local Data Generators (Activity & Horoscope) ---
        function getLocalContent() {
            // Activity
            const randomActivity = ACTIVITIES[Math.floor(Math.random() * ACTIVITIES.length)];
            document.getElementById("activity").textContent = randomActivity;

            // Horoscope/Vibe
            const randomVibe = VIBES[Math.floor(Math.random() * VIBES.length)];
            document.getElementById("horoscope").textContent = randomVibe;
        }

        // --- Image (LoremFlickr - No Key) ---
        function getImage() {
            // Adding a timestamp ensures it doesn't cache the same image forever
            const url = `https://loremflickr.com/640/360/nature,calm,forest/all?lock=${Math.floor(Math.random()*100)}`;
            document.getElementById("dailyImage").src = url;
        }

        // --- Master Update ---
        function updateAll() {
            updateClock();
            getWeather();
            getISS();
            getFact();
            getQuote();
            getNews();
            getLocalContent();
            getImage();
        }

        // Initial Load
        updateAll();
        
        // Timers
        setInterval(updateClock, 1000); // Clock every second
        setInterval(getISS, 10000);     // ISS updates every 10s for movement
        setInterval(updateAll, 1800000); // Refresh everything else every 30 mins
    </script>
</body>

</html>
